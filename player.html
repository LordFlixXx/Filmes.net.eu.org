<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Player de Torrent</title>
    <style>
        /* Remove margens e overflow para que o conteúdo ocupe toda a tela */
        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            background-color: #000;
        }

        #poster {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
            z-index: 1;
        }

        #loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1.5rem;
            color: white;
            z-index: 2;
        }

        #player {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 3;
            display: none; /* O player será exibido apenas após a inicialização */
        }
    </style>
</head>

<body>

    <div id="poster" style="background-image: url('https://i.imgur.com/IG0AIMf.jpeg');"></div>
    <div id="loading">Carregando player...</div>
    <div id="player"></div>

    <script src="https://cdn.jsdelivr.net/npm/@webtor/embed-sdk-js/dist/index.min.js" charset="utf-8" async></script>
    <script>
        function getQueryStringParameter(name) {
            const params = new URLSearchParams(window.location.search);
            return params.get(name);
        }

        const movieId = getQueryStringParameter('id');
        const imdbId = getQueryStringParameter('imdb_id');
        const defaultPoster = 'https://i.imgur.com/IG0AIMf.jpeg';

        if (!movieId) {
            console.error('ID do filme não encontrado na URL');
        } else {
            let posterUrl = defaultPoster;

            if (imdbId) {
                fetch(`https://yts.mx/api/v2/movie_details.json?imdb_id=${imdbId}`)
                    .then(response => response.json())
                    .then(data => {
                        posterUrl = data.data.movie.background_image || defaultPoster;
                        initializePlayer(movieId, posterUrl);
                    })
                    .catch(error => {
                        console.error('Erro ao buscar imagem de fundo:', error);
                        initializePlayer(movieId, posterUrl);
                    });
            } else {
                initializePlayer(movieId, posterUrl);
            }
        }

        function initializePlayer(movieId, posterUrl) {
            const player = document.getElementById('player');
            const poster = document.getElementById('poster');
            const loading = document.getElementById('loading');

            // Atualiza o poster de fundo
            poster.style.backgroundImage = `url('${posterUrl}')`;

            // Inicializa o player Webtor
            window.webtor = window.webtor || [];
            window.webtor.push({
                id: 'player',
                width: '100%',
                height: '100%',
                magnet: `magnet:?xt=urn:btih:${movieId}&dn=${movieId}&tr=`,
                features: {
                    autoSubtitles: true,
                    continue: true,
                    title: false,
                    p2pProgress: true,
                    subtitles: true,
                    settings: false,
                    embed: false,
                    browse: false,
                    download: false,
                    fullscreen: true,
                    playpause: true,
                    currentTime: true,
                    timeline: true,
                    duration: true,
                    volume: true,
                    chromecast: true,
                },
                on: function (e) {
                    if (e.name === window.webtor.INITED) {
                        e.player.play();
                        player.style.display = 'block';
                        poster.style.display = 'none';
                        loading.style.display = 'none';
                    }
                },
            });
        }
    </script>

</body>

</html>
